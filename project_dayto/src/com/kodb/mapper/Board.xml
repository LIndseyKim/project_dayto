<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<resultMap type="Board" id="BoardResultMap">
		<id  property="postId"  column="post_id"/>
		<result property="userEmail" column="user_email" />
		<result property="postName" column="post_name" />
		<result property="postDate" column="post_date" />
		<result property="postContent" column="post_content" />
		<result property="postRecomm" column="post_recomm" />
		<result property="postPublic" column="post_public" />
		
	</resultMap>

	<resultMap type="Blog" id="BlogResultMap">
		<id  property="postId"  column="post_id"/>
		<result property="postName" column="post_name" />
		<result property="postContent" column="post_content" />
	</resultMap>
	
	<insert id="insertBoard" parameterType="Board">
		INSERT INTO BLOG_POST 
		VALUES 
		( seq_blog_post_id.nextVal,#{userEmail}, #{postName}, SYSDATE, #{postContent}, null, #{postPublic})							
	</insert>
	
	<select id="selectBoard" parameterType="String" resultMap="BoardResultMap">
		select *
		from blog_post 
		where user_email = #{value} and	rownum = 1
		order by post_id desc
	</select>
	
	<select id="selectPostName" parameterType="String" resultMap="BoardResultMap">
		select * 
		from blog_post 
		where user_email = #{value}	 and post_public = 1 order by post_id
	</select>	
	
	<resultMap type="Blog" id="PostwithPictureResultMap" extends="BlogResultMap">
		<collection property="pictureList" resultMap="picture.PictureResultMap"></collection>
	</resultMap>
	
	<select id="selectPostWithPicture" parameterType="String" resultMap="PostwithPictureResultMap">
		select 	bp.post_id, bp.post_name, bp.post_content, bpic.post_pic
		from	blog_post  bp, blog_picture bpic
		where	bp.post_id = bpic.post_id
		and		bp.user_email = #{value}
	</select>
	
	<select id="selectPost" parameterType="Integer" resultMap="PostwithPictureResultMap">
		select 	bp.post_id, bp.post_name, bp.post_content, bpic.post_pic
		from	blog_post  bp, blog_picture bpic
		where	bp.post_id = bpic.post_id
		and		bp.post_id = #{value}
	</select>  
	
		<select id="selectPublicBlog" resultMap="BoardResultMap">
		select * 
		from blog_post 
		where post_public = 0 order by post_id
	</select>	
	
</mapper>